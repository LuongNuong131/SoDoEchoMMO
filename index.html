<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EchoMMO - T√†i li·ªáu Ph√¢n t√≠ch & Thi·∫øt k·∫ø H·ªá th·ªëng</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        line-height: 1.7;
        color: #1f2937;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 0;
        min-height: 100vh;
      }

      /* Scroll to top button */
      #scrollTop {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s, transform 0.3s;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #scrollTop.show {
        opacity: 1;
      }

      #scrollTop:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .container {
        max-width: 1400px;
        margin: 30px auto;
        background: white;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 60px 40px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.3;
      }

      .header h1 {
        font-size: 3.5em;
        margin-bottom: 15px;
        font-weight: 800;
        position: relative;
        letter-spacing: -1px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .header p {
        font-size: 1.3em;
        opacity: 0.95;
        font-weight: 400;
        position: relative;
      }

      .content-wrapper {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 0;
        min-height: 80vh;
      }

      .toc-wrapper {
        background: #f8fafc;
        border-right: 1px solid #e2e8f0;
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
        padding: 30px 0;
      }

      .toc {
        padding: 0 25px;
      }

      .toc h2 {
        color: #667eea;
        font-size: 1.4em;
        font-weight: 700;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
      }

      .toc ul {
        list-style: none;
      }

      .toc li {
        margin: 0;
        border-bottom: 1px solid #e2e8f0;
      }

      .toc li:last-child {
        border-bottom: none;
      }

      .toc a {
        color: #475569;
        text-decoration: none;
        font-weight: 500;
        display: block;
        padding: 12px 15px;
        border-radius: 8px;
        transition: all 0.2s ease;
        position: relative;
      }

      .toc a::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 3px;
        height: 0;
        background: linear-gradient(135deg, #667eea, #764ba2);
        transition: height 0.2s ease;
        border-radius: 0 2px 2px 0;
      }

      .toc a:hover {
        color: #667eea;
        background: #ede9fe;
        padding-left: 20px;
      }

      .toc a:hover::before {
        height: 60%;
      }

      .content {
        padding: 50px;
        max-width: 100%;
      }

      .section {
        margin-bottom: 80px;
        animation: slideUp 0.6s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h2 {
        color: #667eea;
        font-size: 2.5em;
        font-weight: 700;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #667eea;
        position: relative;
        display: inline-block;
      }

      h2::after {
        content: "";
        position: absolute;
        bottom: -3px;
        left: 0;
        width: 60px;
        height: 3px;
        background: #764ba2;
      }

      h3 {
        color: #764ba2;
        font-size: 1.8em;
        font-weight: 600;
        margin: 40px 0 25px 0;
        position: relative;
        padding-left: 15px;
      }

      h3::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 5px;
        height: 70%;
        background: linear-gradient(180deg, #667eea, #764ba2);
        border-radius: 3px;
      }

      .diagram-container {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 16px;
        padding: 35px;
        margin: 25px 0;
        border: 1px solid #e2e8f0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .diagram-container:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(102, 126, 234, 0.15);
      }

      .mermaid {
        text-align: center;
        background: white;
        padding: 25px;
        border-radius: 12px;
        overflow-x: auto;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .info-box {
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        border-left: 5px solid #3b82f6;
        padding: 30px;
        border-radius: 12px;
        margin: 25px 0;
        box-shadow: 0 4px 6px rgba(59, 130, 246, 0.1);
        transition: transform 0.2s ease;
      }

      .info-box:hover {
        transform: translateX(5px);
      }

      .info-box h4 {
        color: #1e40af;
        margin-bottom: 15px;
        font-size: 1.3em;
        font-weight: 700;
      }

      .warning-box {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border-left: 5px solid #f59e0b;
        padding: 30px;
        border-radius: 12px;
        margin: 25px 0;
        box-shadow: 0 4px 6px rgba(245, 158, 11, 0.1);
        transition: transform 0.2s ease;
      }

      .warning-box:hover {
        transform: translateX(5px);
      }

      .warning-box h4 {
        color: #92400e;
        margin-bottom: 15px;
        font-size: 1.3em;
        font-weight: 700;
      }

      .mockup-container {
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        border: 3px solid #9ca3af;
        border-radius: 16px;
        padding: 25px;
        margin: 25px 0;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .mockup-container:hover {
        transform: scale(1.01);
      }

      .mockup-screen {
        background: white;
        border: 2px solid #d1d5db;
        border-radius: 12px;
        padding: 20px;
        margin: 15px 0;
        min-height: 300px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .mockup-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 18px;
        border-radius: 8px 8px 0 0;
        margin: -20px -20px 20px -20px;
        font-weight: 700;
        font-size: 1.1em;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .mockup-element {
        border: 2px dashed #d1d5db;
        padding: 20px;
        margin: 15px 0;
        border-radius: 8px;
        background: #fafafa;
        transition: all 0.2s ease;
      }

      .mockup-element:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
      }

      .flow-step {
        background: white;
        border: 2px solid #667eea;
        border-radius: 12px;
        padding: 25px;
        margin: 20px 0;
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .flow-step::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
        background: linear-gradient(180deg, #667eea, #764ba2);
      }

      .flow-step:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(102, 126, 234, 0.2);
        border-color: #764ba2;
      }

      .flow-step strong {
        color: #667eea;
        font-weight: 700;
        font-size: 1.2em;
        display: block;
        margin-bottom: 10px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 30px 0;
        background: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border-radius: 12px;
        overflow: hidden;
      }

      th,
      td {
        padding: 18px;
        text-align: left;
        border: 1px solid #e5e7eb;
        vertical-align: top;
      }

      th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.9em;
        letter-spacing: 0.5px;
      }

      tr {
        transition: background-color 0.2s ease;
      }

      tr:nth-child(even) {
        background: #f9fafb;
      }

      tr:hover {
        background: #f3f4f6;
      }

      code {
        background: #f1f5f9;
        padding: 3px 8px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        color: #dc2626;
        font-size: 0.9em;
      }

      ul {
        margin-left: 25px;
        margin-top: 10px;
      }

      li {
        margin: 8px 0;
        line-height: 1.6;
      }

      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: 600;
        margin: 0 5px;
      }

      .badge-get {
        background: #d1fae5;
        color: #065f46;
      }

      .badge-post {
        background: #dbeafe;
        color: #1e40af;
      }

      .footer {
        text-align: center;
        padding: 50px;
        border-top: 3px solid #e5e7eb;
        margin-top: 80px;
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      }

      .footer h2 {
        color: #667eea;
        border: none;
        padding: 0;
        margin-bottom: 10px;
      }

      /* Responsive Design */
      @media (max-width: 1200px) {
        .content-wrapper {
          grid-template-columns: 250px 1fr;
        }
      }

      @media (max-width: 1024px) {
        .content-wrapper {
          grid-template-columns: 1fr;
        }

        .toc-wrapper {
          position: static;
          height: auto;
          border-right: none;
          border-bottom: 1px solid #e2e8f0;
        }

        .container {
          margin: 20px;
          border-radius: 16px;
        }
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 12px;
        }

        .header {
          padding: 40px 20px;
        }

        .header h1 {
          font-size: 2.5em;
        }

        .content {
          padding: 30px 20px;
        }

        h2 {
          font-size: 2em;
        }

        h3 {
          font-size: 1.5em;
        }

        table {
          display: block;
          overflow-x: auto;
          white-space: nowrap;
        }

        .mockup-screen [style*="grid-template-columns"] {
          grid-template-columns: 1fr !important;
        }
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #667eea, #764ba2);
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #5568d3, #6a3f8f);
      }
    </style>
  </head>
  <body>
    <button
      id="scrollTop"
      onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
    >
      ‚Üë
    </button>

    <div class="container">
      <div class="header">
        <h1>üéÆ EchoMMO</h1>
        <p>T√†i li·ªáu Ph√¢n t√≠ch & Thi·∫øt k·∫ø H·ªá th·ªëng GameFi MMO</p>
      </div>

      <div class="content-wrapper">
        <div class="toc-wrapper">
          <div class="toc">
            <h2>üìë M·ª•c l·ª•c</h2>
            <ul>
              <li><a href="#overview">1. T·ªïng quan H·ªá th·ªëng</a></li>
              <li><a href="#architecture">2. Ki·∫øn tr√∫c H·ªá th·ªëng</a></li>
              <li><a href="#database">3. Thi·∫øt k·∫ø C∆° s·ªü D·ªØ li·ªáu</a></li>
              <li><a href="#auth-flow">4. S∆° ƒë·ªì Ho·∫°t ƒë·ªông - X√°c th·ª±c</a></li>
              <li>
                <a href="#market-flow">5. S∆° ƒë·ªì Ho·∫°t ƒë·ªông - Marketplace</a>
              </li>
              <li><a href="#game-flow">6. S∆° ƒë·ªì Ho·∫°t ƒë·ªông - Gameplay</a></li>
              <li><a href="#admin-flow">7. S∆° ƒë·ªì Ho·∫°t ƒë·ªông - Qu·∫£n tr·ªã</a></li>
              <li><a href="#mockups">8. Mockup Giao di·ªán</a></li>
              <li><a href="#implementation">9. Quy tr√¨nh Tri·ªÉn khai</a></li>
              <li><a href="#appendix-a">Ph·ª• l·ª•c A: Stored Procedures</a></li>
              <li><a href="#appendix-b">Ph·ª• l·ª•c B: API Endpoints</a></li>
            </ul>
          </div>
        </div>

        <div class="content">
          <div class="section" id="overview">
            <h2>1. üéØ T·ªïng quan H·ªá th·ªëng</h2>

            <div class="info-box">
              <h4>Gi·ªõi thi·ªáu D·ª± √°n</h4>
              <p>
                <strong>EchoMMO</strong> l√† m·ªôt n·ªÅn t·∫£ng GameFi k·∫øt h·ª£p gi·ªØa
                game MMO truy·ªÅn th·ªëng v·ªõi c√¥ng ngh·ªá blockchain. Ng∆∞·ªùi ch∆°i c√≥
                th·ªÉ:
              </p>
              <ul>
                <li>üéÆ Tham gia phi√™u l∆∞u, chi·∫øn ƒë·∫•u v·ªõi qu√°i v·∫≠t</li>
                <li>‚õèÔ∏è Thu th·∫≠p nguy√™n li·ªáu (ƒë√°, g·ªó, c√°, qu·∫∑ng)</li>
                <li>üõ°Ô∏è Trang b·ªã v≈© kh√≠, gi√°p ƒë·ªÉ tƒÉng s·ª©c m·∫°nh</li>
                <li>üè™ Mua b√°n v·∫≠t ph·∫©m tr√™n Marketplace</li>
                <li>üí∞ Qu·∫£n l√Ω t√†i s·∫£n trong V√≠ ƒëi·ªán t·ª≠</li>
                <li>üìà N√¢ng c·∫•p nh√¢n v·∫≠t v√† k·ªπ nƒÉng thu th·∫≠p</li>
              </ul>
            </div>

            <h3>C√¥ng ngh·ªá S·ª≠ d·ª•ng</h3>
            <table>
              <tr>
                <th>Ph·∫ßn</th>
                <th>C√¥ng ngh·ªá</th>
                <th>M√¥ t·∫£</th>
              </tr>
              <tr>
                <td><strong>Backend</strong></td>
                <td>Spring Boot 3.3.0, Java 17</td>
                <td>Framework ch√≠nh, RESTful API</td>
              </tr>
              <tr>
                <td><strong>Frontend</strong></td>
                <td>Thymeleaf, HTML/CSS/JavaScript</td>
                <td>Template engine, giao di·ªán ng∆∞·ªùi d√πng</td>
              </tr>
              <tr>
                <td><strong>Database</strong></td>
                <td>SQL Server</td>
                <td>L∆∞u tr·ªØ d·ªØ li·ªáu ng∆∞·ªùi d√πng, v·∫≠t ph·∫©m, giao d·ªãch</td>
              </tr>
              <tr>
                <td><strong>Security</strong></td>
                <td>Spring Security, BCrypt</td>
                <td>X√°c th·ª±c, ph√¢n quy·ªÅn, m√£ h√≥a m·∫≠t kh·∫©u</td>
              </tr>
              <tr>
                <td><strong>ORM</strong></td>
                <td>Hibernate, JPA</td>
                <td>√Ånh x·∫° ƒë·ªëi t∆∞·ª£ng - quan h·ªá</td>
              </tr>
            </table>
          </div>

          <div class="section" id="architecture">
            <h2>2. üèóÔ∏è Ki·∫øn tr√∫c H·ªá th·ªëng</h2>

            <div class="diagram-container">
              <pre class="mermaid">
graph TB
    subgraph "Client Layer"
        Web[üåê Web Browser]
    end

    subgraph "Presentation Layer"
        Thyme[Thymeleaf Templates]
        Static[Static Resources<br/>CSS/JS/Images]
    end

    subgraph "Application Layer"
        AuthCtrl[AuthController]
        MarketCtrl[MarketplaceController]
        InvCtrl[InventoryController]
        GameCtrl[MinigameController]
        ProfileCtrl[ProfileController]
    end

    subgraph "Service Layer"
        AuthSvc[AuthService]
        MarketSvc[MarketplaceService]
        CharSvc[CharacterService]
        GatherSvc[GatheringService]
        BattleSvc[BattleService]
    end

    subgraph "Data Access Layer"
        UserRepo[UserRepository]
        ItemRepo[ItemRepository]
        MarketRepo[MarketListingRepository]
        WalletRepo[WalletRepository]
        CharRepo[CharacterRepository]
    end

    subgraph "Database Layer"
        DB[(SQL Server<br/>GameFiDB)]
    end

    Web --> Thyme
    Web --> Static
    Thyme --> AuthCtrl
    Thyme --> MarketCtrl
    Thyme --> InvCtrl
    Thyme --> GameCtrl
    Thyme --> ProfileCtrl

    AuthCtrl --> AuthSvc
    MarketCtrl --> MarketSvc
    InvCtrl --> CharSvc
    GameCtrl --> GatherSvc
    GameCtrl --> BattleSvc
    ProfileCtrl --> CharSvc

    AuthSvc --> UserRepo
    MarketSvc --> MarketRepo
    MarketSvc --> ItemRepo
    MarketSvc --> WalletRepo
    CharSvc --> CharRepo
    GatherSvc --> CharRepo
    BattleSvc --> CharRepo

    UserRepo --> DB
    ItemRepo --> DB
    MarketRepo --> DB
    WalletRepo --> DB
    CharRepo --> DB
            </pre>
            </div>

            <div class="info-box">
              <h4>üìù Gi·∫£i th√≠ch Ki·∫øn tr√∫c Ph√¢n t·∫ßng</h4>
              <p>
                <strong>1. Client Layer:</strong> Tr√¨nh duy·ªát web c·ªßa ng∆∞·ªùi d√πng
              </p>
              <p>
                <strong>2. Presentation Layer:</strong> Thymeleaf render HTML
                ƒë·ªông, k·∫øt h·ª£p CSS/JS
              </p>
              <p>
                <strong>3. Application Layer (Controllers):</strong> Nh·∫≠n
                request, g·ªçi Service, tr·∫£ response
              </p>
              <p>
                <strong>4. Service Layer:</strong> X·ª≠ l√Ω business logic,
                transaction
              </p>
              <p>
                <strong>5. Data Access Layer (Repositories):</strong> T∆∞∆°ng t√°c
                v·ªõi database qua JPA
              </p>
              <p>
                <strong>6. Database Layer:</strong> SQL Server l∆∞u tr·ªØ
                persistent data
              </p>
            </div>
          </div>

          <div class="section" id="database">
            <h2>3. üóÑÔ∏è Thi·∫øt k·∫ø C∆° s·ªü D·ªØ li·ªáu</h2>

            <h3>S∆° ƒë·ªì ERD (Entity Relationship Diagram)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
erDiagram
    USER ||--o{ CHARACTER_GAME : has
    USER ||--|| WALLET : owns
    USER ||--o{ USER_ITEM : owns
    USER ||--o{ MARKET_LISTING : sells
    USER ||--o{ USER_QUEST : performs
    USER }o--|| ROLE : belongs_to
    
    ITEM ||--o{ USER_ITEM : contained_in
    ITEM ||--o{ MARKET_LISTING : listed_as
    
    CHARACTER_GAME ||--o{ CHARACTER_GATHERING : has_skills
    
    QUEST ||--o{ USER_QUEST : performed_in
    
    MARKET_LISTING ||--o| TRANSACTION_HISTORY : generates
    
    USER ||--o{ TRANSACTION_HISTORY : buyer
    USER ||--o{ TRANSACTION_HISTORY : seller

    USER {
        int user_id PK
        nvarchar username UK
        nvarchar password_hash
        nvarchar email UK
        nvarchar full_name
        int role_id FK
        bit is_active
        datetime2 created_at
    }

    ROLE {
        int role_id PK
        nvarchar role_name UK
        nvarchar description
    }

    WALLET {
        int wallet_id PK
        int user_id FK
        decimal balance
        datetime2 created_at
        datetime2 updated_at
    }

    CHARACTER_GAME {
        int character_id PK
        int user_id FK
        nvarchar name
        int level
        int experience
        int health
        int max_health
        int atk
        int def
        int energy
        int max_energy
        int upgrade_points
    }

    CHARACTER_GATHERING {
        bigint id PK
        int character_id FK
        varchar resource_type
        int level
        int exp
    }

    ITEM {
        int item_id PK
        nvarchar name
        nvarchar description
        nvarchar rarity
        decimal base_price
        nvarchar item_category
        varchar game_slot
        int game_atk
        int game_def
        int game_heal
    }

    USER_ITEM {
        int user_item_id PK
        int user_id FK
        int item_id FK
        int quantity
        bit is_equipped
        datetime2 acquired_at
    }

    MARKET_LISTING {
        int listing_id PK
        int seller_id FK
        int item_id FK
        int quantity
        decimal price
        nvarchar listing_type
        nvarchar price_type
        nvarchar status
        datetime2 created_at
    }

    TRANSACTION_HISTORY {
        int transaction_id PK
        int buyer_id FK
        int seller_id FK
        int item_id FK
        int listing_id FK
        int quantity
        decimal amount
        nvarchar transaction_type
        datetime2 created_at
    }

    QUEST {
        int quest_id PK
        nvarchar name
        nvarchar description
        decimal reward_gold
        int reward_exp
        int required_level
    }

    USER_QUEST {
        int user_quest_id PK
        int user_id FK
        int quest_id FK
        nvarchar status
        datetime2 started_at
        datetime2 completed_at
    }
            </pre
              >
            </div>

            <div class="info-box">
              <h4>üîë Gi·∫£i th√≠ch c√°c B·∫£ng ch√≠nh</h4>
              <p>
                <strong>user:</strong> L∆∞u th√¥ng tin t√†i kho·∫£n (username,
                password, email, role)
              </p>
              <p>
                <strong>wallet:</strong> Qu·∫£n l√Ω s·ªë d∆∞ v√†ng c·ªßa ng∆∞·ªùi ch∆°i (1-1
                v·ªõi user)
              </p>
              <p>
                <strong>character_game:</strong> Th√¥ng tin nh√¢n v·∫≠t trong game
                (HP, ATK, DEF, level)
              </p>
              <p>
                <strong>character_gathering:</strong> K·ªπ nƒÉng thu th·∫≠p (stone,
                wood, fish, ore)
              </p>
              <p>
                <strong>item:</strong> Danh m·ª•c v·∫≠t ph·∫©m (v≈© kh√≠, gi√°p, potion,
                nguy√™n li·ªáu)
              </p>
              <p>
                <strong>user_item:</strong> Kho ƒë·ªì c·ªßa ng∆∞·ªùi ch∆°i (s·ªë l∆∞·ª£ng,
                trang b·ªã)
              </p>
              <p><strong>market_listing:</strong> V·∫≠t ph·∫©m ƒëang b√°n tr√™n ch·ª£</p>
              <p>
                <strong>transaction_history:</strong> L·ªãch s·ª≠ giao d·ªãch mua/b√°n
              </p>
            </div>
          </div>

          <div class="section" id="auth-flow">
            <h2>4. üîê S∆° ƒë·ªì Ho·∫°t ƒë·ªông - X√°c th·ª±c</h2>

            <h3>4.1. ƒêƒÉng k√Ω T√†i kho·∫£n</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([üë§ B·∫Øt ƒë·∫ßu ƒêƒÉng k√Ω]) --> OpenRegister[M·ªü trang /register]
    OpenRegister --> FillForm[üìù ƒêi·ªÅn form ƒëƒÉng k√Ω<br/>Username, Email, Password, Confirm]
    FillForm --> Submit[Nh·∫•n 'ƒêƒÉng k√Ω']
    Submit --> ValidateInput{‚úì Ki·ªÉm tra d·ªØ li·ªáu}
    
    ValidateInput -->|Password kh√¥ng kh·ªõp| ErrorConfirm[‚ùå L·ªói: M·∫≠t kh·∫©u kh√¥ng kh·ªõp]
    ErrorConfirm --> FillForm
    
    ValidateInput -->|H·ª£p l·ªá| CheckUsername{‚úì Username<br/>ƒë√£ t·ªìn t·∫°i?}
    CheckUsername -->|ƒê√£ t·ªìn t·∫°i| ErrorUsername[‚ùå L·ªói: Username ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng]
    ErrorUsername --> FillForm
    
    CheckUsername -->|Ch∆∞a t·ªìn t·∫°i| CheckEmail{‚úì Email<br/>ƒë√£ t·ªìn t·∫°i?}
    CheckEmail -->|ƒê√£ t·ªìn t·∫°i| ErrorEmail[‚ùå L·ªói: Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng]
    ErrorEmail --> FillForm
    
    CheckEmail -->|Ch∆∞a t·ªìn t·∫°i| BeginTransaction[(üîÑ BEGIN TRANSACTION)]
    BeginTransaction --> CreateUser[üìù T·∫°o User m·ªõi<br/>- Hash password<br/>- Role = Player<br/>- is_active = true]
    CreateUser --> CreateWallet[üí∞ T·∫°o Wallet<br/>- balance = 0]
    CreateWallet --> CreateCharacter[üßô T·∫°o Character<br/>- Level 1<br/>- HP, ATK, DEF m·∫∑c ƒë·ªãnh]
    CreateCharacter --> InitGathering[‚õèÔ∏è Kh·ªüi t·∫°o k·ªπ nƒÉng thu th·∫≠p<br/>- Stone, Wood, Fish, Ore<br/>- Level 1]
    InitGathering --> Commit[(‚úÖ COMMIT)]
    Commit --> Success[‚úîÔ∏è ƒêƒÉng k√Ω th√†nh c√¥ng]
    Success --> RedirectLogin[üîÑ Chuy·ªÉn ƒë·∫øn /login]
    RedirectLogin --> End([üèÅ K·∫øt th√∫c])
    
    BeginTransaction -.->|L·ªói SQL| Rollback[(‚ùå ROLLBACK)]
    Rollback --> ErrorDB[‚ùå L·ªói h·ªá th·ªëng]
    ErrorDB --> FillForm
            </pre>
            </div>

            <h3>4.2. ƒêƒÉng nh·∫≠p</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([üîì B·∫Øt ƒë·∫ßu ƒêƒÉng nh·∫≠p]) --> OpenLogin[M·ªü trang /login]
    OpenLogin --> FillCred[üìù Nh·∫≠p Username & Password]
    FillCred --> Submit[Nh·∫•n 'Sign in']
    Submit --> FindUser{üîç T√¨m User<br/>trong database}
    
    FindUser -->|Kh√¥ng t√¨m th·∫•y| ErrorNotFound[‚ùå L·ªói: Username kh√¥ng t·ªìn t·∫°i]
    ErrorNotFound --> FillCred
    
    FindUser -->|T√¨m th·∫•y| CheckActive{‚úì Account<br/>is_active?}
    CheckActive -->|B·ªã kh√≥a| ErrorInactive[‚ùå L·ªói: T√†i kho·∫£n ƒë√£ b·ªã kh√≥a]
    ErrorInactive --> FillCred
    
    CheckActive -->|Active| VerifyPassword{üîê BCrypt verify<br/>password?}
    VerifyPassword -->|Sai| ErrorPassword[‚ùå L·ªói: M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng]
    ErrorPassword --> FillCred
    
    VerifyPassword -->|ƒê√∫ng| CreateSession[‚úÖ T·∫°o Session<br/>Spring Security Authentication]
    CreateSession --> UpdateLastLogin[üìÖ C·∫≠p nh·∫≠t last_login]
    UpdateLastLogin --> CheckRole{üë§ Role?}
    
    CheckRole -->|ADMIN| RedirectAdmin[üîÑ Chuy·ªÉn ƒë·∫øn /admin/dashboard]
    CheckRole -->|PLAYER| RedirectHome[üîÑ Chuy·ªÉn ƒë·∫øn /]
    
    RedirectAdmin --> End([üèÅ K·∫øt th√∫c])
    RedirectHome --> End
            </pre>
            </div>
          </div>

          <div class="section" id="market-flow">
            <h2>5. üè™ S∆° ƒë·ªì Ho·∫°t ƒë·ªông - Marketplace</h2>

            <h3>5.1. ƒêƒÉng b√°n V·∫≠t ph·∫©m (Player Listing)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([üõí B·∫Øt ƒë·∫ßu ƒêƒÉng b√°n]) --> OpenCreate[M·ªü /marketplace/create]
    OpenCreate --> SelectTab[Ch·ªçn tab 'B√°n cho Player']
    SelectTab --> ClickSelect[Click 'Ch·ªçn t·ª´ kho']
    ClickSelect --> ShowModal[üì¶ Hi·ªán modal danh s√°ch<br/>v·∫≠t ph·∫©m trong inventory]
    ShowModal --> SelectItem[Ch·ªçn v·∫≠t ph·∫©m mu·ªën b√°n]
    SelectItem --> FillForm[üìù ƒêi·ªÅn s·ªë l∆∞·ª£ng & gi√° b√°n]
    FillForm --> Submit[Nh·∫•n 'ƒêƒÉng b√°n']
    Submit --> ValidateQty{‚úì ƒê·ªß s·ªë l∆∞·ª£ng<br/>trong kho?}
    
    ValidateQty -->|Kh√¥ng ƒë·ªß| ErrorQty[‚ùå L·ªói: Kh√¥ng ƒë·ªß v·∫≠t ph·∫©m]
    ErrorQty --> FillForm
    
    ValidateQty -->|ƒê·ªß| CallStoredProc[üîß G·ªçi Stored Procedure<br/>sp_create_player_listing]
    CallStoredProc --> BeginTrans[(üîÑ BEGIN TRANSACTION)]
    BeginTrans --> DeductItem[‚ûñ Tr·ª´ v·∫≠t ph·∫©m<br/>t·ª´ user_item]
    DeductItem --> CreateListing[üìù T·∫°o record<br/>market_listing<br/>- status = Active<br/>- price_type = Player]
    CreateListing --> Commit[(‚úÖ COMMIT)]
    Commit --> Success[‚úîÔ∏è ƒêƒÉng b√°n th√†nh c√¥ng]
    Success --> RedirectMyListings[üîÑ Chuy·ªÉn ƒë·∫øn /marketplace/my-listings]
    RedirectMyListings --> End([üèÅ K·∫øt th√∫c])
    
    BeginTrans -.->|L·ªói| Rollback[(‚ùå ROLLBACK)]
    Rollback --> ErrorDB[‚ùå L·ªói h·ªá th·ªëng]
    ErrorDB --> FillForm
            </pre>
            </div>

            <h3>5.2. Mua V·∫≠t ph·∫©m t·ª´ Marketplace</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([üí∞ B·∫Øt ƒë·∫ßu Mua h√†ng]) --> Browse[Duy·ªát /marketplace]
    Browse --> UseFilter{üîç D√πng b·ªô l·ªçc?}
    UseFilter -->|C√≥| Filter[L·ªçc theo:<br/>- T√¨m ki·∫øm t·ª´ kh√≥a<br/>- Category<br/>- Gi√° t·ªëi ƒëa]
    UseFilter -->|Kh√¥ng| ViewAll[Xem t·∫•t c·∫£ listing]
    Filter --> ViewList[üìã Xem danh s√°ch v·∫≠t ph·∫©m]
    ViewAll --> ViewList
    ViewList --> SelectItem[Ch·ªçn v·∫≠t ph·∫©m mu·ªën mua]
    SelectItem --> ClickBuy[Click 'Mua ngay']
    ClickBuy --> ConfirmDialog{‚ö†Ô∏è X√°c nh·∫≠n mua?}
    
    ConfirmDialog -->|H·ªßy| ViewList
    ConfirmDialog -->|OK| CallStoredProc[üîß G·ªçi sp_buy_from_market]
    CallStoredProc --> BeginTrans[(üîÑ BEGIN TRANSACTION)]
    BeginTrans --> CheckListing{‚úì Listing<br/>c√≤n Active?}
    
    CheckListing -->|ƒê√£ b√°n/h·ªßy| ErrorSold[‚ùå L·ªói: V·∫≠t ph·∫©m ƒë√£ b√°n]
    ErrorSold --> End([üèÅ K·∫øt th√∫c])
    
    CheckListing -->|Active| CheckSelf{‚úì Mua h√†ng<br/>c·ªßa m√¨nh?}
    CheckSelf -->|C√≥| ErrorSelf[‚ùå L·ªói: Kh√¥ng th·ªÉ mua h√†ng c·ªßa m√¨nh]
    ErrorSelf --> End
    
    CheckSelf -->|Kh√¥ng| CheckBalance{‚úì ƒê·ªß ti·ªÅn<br/>trong v√≠?}
    CheckBalance -->|Kh√¥ng ƒë·ªß| ErrorMoney[‚ùå L·ªói: S·ªë d∆∞ kh√¥ng ƒë·ªß]
    ErrorMoney --> End
    
    CheckBalance -->|ƒê·ªß| DeductMoney[‚ûñ Tr·ª´ ti·ªÅn ng∆∞·ªùi mua<br/>UPDATE wallet]
    DeductMoney --> CalcFee[üíµ T√≠nh ph√≠ 5%<br/>fee = price * 0.05]
    CalcFee --> AddMoneyCheck{üí∞ Giao d·ªãch<br/>lo·∫°i g√¨?}
    AddMoneyCheck -->|Player-to-Player| AddMoney[‚ûï C·ªông ti·ªÅn ng∆∞·ªùi b√°n<br/>amount = price - fee]
    AddMoneyCheck -->|System/Admin| SkipAddMoney[B·ªè qua c·ªông ti·ªÅn<br/>Ti·ªÅn v·ªÅ h·ªá th·ªëng]
    AddMoney --> AddItem[üì¶ Th√™m v·∫≠t ph·∫©m<br/>v√†o kho ng∆∞·ªùi mua]
    SkipAddMoney --> AddItem
    AddItem --> UpdateStatus[üìù C·∫≠p nh·∫≠t listing<br/>status = Sold<br/>sold_at = GETDATE]
    UpdateStatus --> LogTransaction[üìä Ghi transaction_history<br/>- buyer_id, seller_id<br/>- item_id, amount]
    LogTransaction --> Commit[(‚úÖ COMMIT)]
    Commit --> Success[‚úîÔ∏è Mua h√†ng th√†nh c√¥ng]
    Success --> Reload[üîÑ Reload trang marketplace]
    Reload --> End
            </pre>
            </div>
          </div>

          <div class="section" id="game-flow">
            <h2>6. üéÆ S∆° ƒë·ªì Ho·∫°t ƒë·ªông - Gameplay</h2>

            <h3>6.1. Phi√™u l∆∞u (Adventure)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([B·∫Øt ƒë·∫ßu Phi√™u l∆∞u]) --> OpenMinigame[M·ªü /minigame]
    OpenMinigame --> CheckEnergy{ƒê·ªß 10 Energy?}
    
    CheckEnergy -->|Kh√¥ng| ErrorEnergy[Kh√¥ng ƒë·ªß nƒÉng l∆∞·ª£ng]
    ErrorEnergy --> End([K·∫øt th√∫c])
    
    CheckEnergy -->|C√≥| ClickAdventure[Click Phi√™u l∆∞u]
    ClickAdventure --> CallAPI[POST /api/minigame/adventure]
    CallAPI --> DeductEnergy[Tr·ª´ 10 Energy]
    DeductEnergy --> RollEncounter[Random g·∫∑p g√¨?]
    
    RollEncounter -->|Enemy 20%| FindEnemy[Random enemy t·ª´ DB]
    FindEnemy --> RedirectBattle[Redirect /battle]
    RedirectBattle --> End
    
    RollEncounter -->|Resource 40%| FindResource[Random resource]
    FindResource --> RedirectGather[Redirect /gathering]
    RedirectGather --> End
    
    RollEncounter -->|Gold 25%| RandGold[Random 10-20 v√†ng]
    RandGold --> AddGold[C·ªông v√†o wallet]
    AddGold --> ShowMessage[Hi·ªán th√¥ng b√°o]
    ShowMessage --> UpdateUI[C·∫≠p nh·∫≠t UI]
    UpdateUI --> End
    
    RollEncounter -->|EXP 15%| RandExp[Random 15-35 EXP]
    RandExp --> AddExp[C·ªông v√†o experience]
    AddExp --> CheckLevel{ƒê·ªß EXP l√™n c·∫•p?}
    CheckLevel -->|C√≥| LevelUp[LEVEL UP]
    CheckLevel -->|Kh√¥ng| ShowExpMsg[B·∫°n nh·∫≠n EXP]
    LevelUp --> ShowLevelMsg[CH√öC M·ª™NG L√äN C·∫§P]
    ShowExpMsg --> UpdateUI
    ShowLevelMsg --> UpdateUI
            </pre
              >
            </div>

            <h3>6.2. Thu th·∫≠p T√†i nguy√™n (Gathering)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([B·∫Øt ƒë·∫ßu Thu th·∫≠p]) --> RedirectFrom[T·ª´ Adventure redirect]
    RedirectFrom --> LoadPage[Load trang thu th·∫≠p]
    LoadPage --> ShowInfo[Hi·ªÉn th·ªã th√¥ng tin]
    ShowInfo --> CheckEnergy{ƒê·ªß 5 Energy?}
    
    CheckEnergy -->|Kh√¥ng| ErrorEnergy[Kh√¥ng ƒë·ªß nƒÉng l∆∞·ª£ng]
    ErrorEnergy --> End([K·∫øt th√∫c])
    
    CheckEnergy -->|C√≥| ClickGather[Click Thu th·∫≠p]
    ClickGather --> CallAPI[POST /api/gathering/gather]
    CallAPI --> BeginLogic[B·∫Øt ƒë·∫ßu x·ª≠ l√Ω]
    BeginLogic --> DeductEnergy[Tr·ª´ 5 Energy]
    DeductEnergy --> RandAmount[Random s·ªë l∆∞·ª£ng]
    RandAmount --> AddToInventory[Th√™m v√†o inventory]
    AddToInventory --> CalcExp[T√≠nh EXP gain]
    CalcExp --> AddSkillExp[C·ªông v√†o skill exp]
    AddSkillExp --> CheckSkillLevel{ƒê·ªß EXP l√™n c·∫•p?}
    
    CheckSkillLevel -->|C√≥| SkillLevelUp[SKILL LEVEL UP]
    CheckSkillLevel -->|Kh√¥ng| SkipSkillUp[Gi·ªØ nguy√™n level]
    SkillLevelUp --> ShowResult[Hi·ªán th√¥ng b√°o level up]
    SkipSkillUp --> ShowNormalResult[Hi·ªán th√¥ng b√°o th∆∞·ªùng]
    ShowResult --> UpdateUI[C·∫≠p nh·∫≠t UI]
    ShowNormalResult --> UpdateUI
    UpdateUI --> CanContinue{C√≤n Energy?}
    CanContinue -->|C√≥| ClickGather
    CanContinue -->|Kh√¥ng| End
            </pre
              >
            </div>

            <h3>6.3. Chi·∫øn ƒë·∫•u (Battle)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([B·∫Øt ƒë·∫ßu Chi·∫øn ƒë·∫•u]) --> LoadBattle[Load battle page]
    LoadBattle --> InitState[Kh·ªüi t·∫°o tr·∫°ng th√°i]
    InitState --> ShowBattle[Hi·ªÉn th·ªã giao di·ªán]
    ShowBattle --> ChooseAction{Ch·ªçn h√†nh ƒë·ªông}
    
    ChooseAction -->|T·∫•n c√¥ng| CallAttack[POST /api/battle/attack]
    CallAttack --> CalcPlayerDmg[T√≠nh s√°t th∆∞∆°ng Player]
    CalcPlayerDmg --> DamageEnemy[Tr·ª´ HP Enemy]
    DamageEnemy --> LogPlayerAttack[Log t·∫•n c√¥ng]
    LogPlayerAttack --> CheckEnemyDead{Enemy HP <= 0?}
    
    CheckEnemyDead -->|C√≥| Victory[CHI·∫æN TH·∫ÆNG]
    Victory --> RandReward[Random ph·∫ßn th∆∞·ªüng]
    RandReward --> AddRewards[C·ªông EXP v√† Gold]
    AddRewards --> ShowVictory[M√†n h√¨nh th·∫Øng]
    ShowVictory --> End([K·∫øt th√∫c])
    
    CheckEnemyDead -->|Kh√¥ng| EnemyTurn[L∆∞·ª£t Enemy]
    EnemyTurn --> CalcEnemyDmg[T√≠nh ST Enemy]
    CalcEnemyDmg --> DamagePlayer[Tr·ª´ HP Player]
    DamagePlayer --> LogEnemyAttack[Log t·∫•n c√¥ng Enemy]
    LogEnemyAttack --> CheckPlayerDead{Player HP <= 0?}
    
    CheckPlayerDead -->|C√≥| Defeat[TH·∫§T B·∫†I]
    Defeat --> Respawn[Respawn v·ªõi 1 HP]
    Respawn --> ShowDefeat[M√†n h√¨nh thua]
    ShowDefeat --> End
    
    CheckPlayerDead -->|Kh√¥ng| UpdateBattleUI[C·∫≠p nh·∫≠t UI]
    UpdateBattleUI --> ChooseAction
    
    ChooseAction -->|D√πng Potion| ShowPotionList[Hi·ªán danh s√°ch Potion]
    ShowPotionList --> SelectPotion[Ch·ªçn Potion]
    SelectPotion --> CallUseItem[POST /api/battle/use-item]
    CallUseItem --> CheckPotionQty{C√≤n Potion?}
    CheckPotionQty -->|Kh√¥ng| ErrorNoPotion[ƒê√£ h·∫øt Potion]
    ErrorNoPotion --> ChooseAction
    CheckPotionQty -->|C√≥| HealPlayer[H·ªìi HP]
    HealPlayer --> DeductPotion[Gi·∫£m s·ªë l∆∞·ª£ng Potion]
    DeductPotion --> LogUsePotion[Log d√πng Potion]
    LogUsePotion --> EnemyTurn
    
    ChooseAction -->|B·ªè ch·∫°y| Flee[Tho√°t chi·∫øn ƒë·∫•u]
    Flee --> ShowFlee[B·∫°n ƒë√£ b·ªè ch·∫°y]
    ShowFlee --> End
            </pre
              >
            </div>

            <h3>6.4. Ngh·ªâ ng∆°i (Rest)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([B·∫Øt ƒë·∫ßu Ngh·ªâ ng∆°i]) --> ClickRest[Click Ngh·ªâ ng∆°i]
    ClickRest --> CallAPI[POST /api/minigame/rest]
    CallAPI --> CheckFull{HP v√† Energy ƒë√£ ƒë·∫ßy?}
    
    CheckFull -->|C√≥| ShowAlready[NƒÉng l∆∞·ª£ng ƒë√£ ƒë·∫ßy]
    ShowAlready --> End([K·∫øt th√∫c])
    
    CheckFull -->|Ch∆∞a| CalcRestore[T√≠nh h·ªìi ph·ª•c]
    CalcRestore --> RestoreStats[C·ªông Energy v√† HP]
    RestoreStats --> SaveDB[L∆∞u v√†o database]
    SaveDB --> ShowMsg[Hi·ªán th√¥ng b√°o]
    ShowMsg --> UpdateUI[C·∫≠p nh·∫≠t UI]
    UpdateUI --> End
            </pre
              >
            </div>
          </div>

          <div class="section" id="admin-flow">
            <h2>7. üëë S∆° ƒë·ªì Ho·∫°t ƒë·ªông - Qu·∫£n tr·ªã</h2>

            <h3>7.1. Th√™m V·∫≠t ph·∫©m m·ªõi (Admin)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([B·∫Øt ƒë·∫ßu Th√™m Item]) --> CheckRole{Role = ADMIN?}
    CheckRole -->|Kh√¥ng| ErrorPerm[L·ªói: Kh√¥ng c√≥ quy·ªÅn]
    ErrorPerm --> End([K·∫øt th√∫c])
    
    CheckRole -->|C√≥| OpenForm[M·ªü form t·∫°o item]
    OpenForm --> FillData[ƒêi·ªÅn th√¥ng tin item]
    FillData --> Submit[Nh·∫•n T·∫°o]
    Submit --> ValidateData{D·ªØ li·ªáu h·ª£p l·ªá?}
    
    ValidateData -->|Kh√¥ng| ErrorValid[L·ªói validate]
    ErrorValid --> FillData
    
    ValidateData -->|C√≥| CallProc[G·ªçi sp_admin_create_item]
    CallProc --> InsertItem[INSERT INTO item]
    InsertItem --> GetItemId[L·∫•y item_id v·ª´a t·∫°o]
    GetItemId --> LogAdmin[Ghi admin_log]
    LogAdmin --> Success[T·∫°o item th√†nh c√¥ng]
    Success --> ReturnId[Tr·∫£ v·ªÅ item_id]
    ReturnId --> End
            </pre
              >
            </div>

            <h3>7.2. T·∫∑ng V·∫≠t ph·∫©m cho Player (Admin)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([B·∫Øt ƒë·∫ßu T·∫∑ng Item]) --> CheckRole{Role = ADMIN?}
    CheckRole -->|Kh√¥ng| ErrorPerm[Kh√¥ng c√≥ quy·ªÅn]
    ErrorPerm --> End([K·∫øt th√∫c])
    
    CheckRole -->|C√≥| SelectUser[Ch·ªçn User nh·∫≠n qu√†]
    SelectUser --> SelectItem[Ch·ªçn Item t·∫∑ng]
    SelectItem --> InputQty[Nh·∫≠p s·ªë l∆∞·ª£ng]
    InputQty --> Submit[Nh·∫•n T·∫∑ng]
    Submit --> CallProc[G·ªçi sp_admin_grant_item]
    CallProc --> BeginTrans[BEGIN TRANSACTION]
    BeginTrans --> CheckUser{User t·ªìn t·∫°i?}
    
    CheckUser -->|Kh√¥ng| ErrorUser[User kh√¥ng t·ªìn t·∫°i]
    ErrorUser --> Rollback1[ROLLBACK]
    Rollback1 --> End
    
    CheckUser -->|C√≥| CheckItem{Item t·ªìn t·∫°i?}
    CheckItem -->|Kh√¥ng| ErrorItem[Item kh√¥ng t·ªìn t·∫°i]
    ErrorItem --> Rollback2[ROLLBACK]
    Rollback2 --> End
    
    CheckItem -->|C√≥| CheckExist{User ƒë√£ c√≥ item?}
    CheckExist -->|C√≥| UpdateQty[UPDATE user_item quantity]
    CheckExist -->|Kh√¥ng| InsertNew[INSERT user_item m·ªõi]
    UpdateQty --> LogTrans[Ghi transaction_history]
    InsertNew --> LogTrans
    LogTrans --> LogAdmin[Ghi admin_log]
    LogAdmin --> Commit[COMMIT]
    Commit --> Success[T·∫∑ng th√†nh c√¥ng]
    Success --> End
            </pre
              >
            </div>

            <h3>7.3. Kh√≥a/M·ªü kh√≥a T√†i kho·∫£n (Admin)</h3>
            <div class="diagram-container">
              <pre class="mermaid">
flowchart TD
    Start([B·∫Øt ƒë·∫ßu]) --> CheckRole{Role = ADMIN?}
    CheckRole -->|Kh√¥ng| ErrorPerm[Kh√¥ng c√≥ quy·ªÅn]
    ErrorPerm --> End([K·∫øt th√∫c])
    
    CheckRole -->|C√≥| ViewUserList[Xem danh s√°ch User]
    ViewUserList --> SelectUser[Ch·ªçn User]
    SelectUser --> CheckTarget{Target l√† Admin?}
    
    CheckTarget -->|C√≥| ErrorAdmin[Kh√¥ng th·ªÉ kh√≥a Admin]
    ErrorAdmin --> ViewUserList
    
    CheckTarget -->|Kh√¥ng| ChooseAction{Ch·ªçn h√†nh ƒë·ªông}
    ChooseAction -->|Kh√≥a| SetInactive[is_active = 0]
    ChooseAction -->|M·ªü kh√≥a| SetActive[is_active = 1]
    
    SetInactive --> CallProc[G·ªçi sp_admin_toggle_user_status]
    SetActive --> CallProc
    CallProc --> UpdateUser[UPDATE user is_active]
    UpdateUser --> LogAction[Ghi admin_log]
    LogAction --> Success[Th√†nh c√¥ng]
    Success --> Refresh[Refresh danh s√°ch]
    Refresh --> End
            </pre
              >
            </div>
          </div>

          <div class="section" id="mockups">
            <h2>8. üé® Mockup Giao di·ªán</h2>

            <h3>8.1. Trang ƒêƒÉng nh·∫≠p</h3>
            <div class="mockup-container">
              <div class="mockup-screen">
                <div class="mockup-header">üîê Login - EchoMMO</div>
                <div style="text-align: center; padding: 20px">
                  <div style="font-size: 3em; margin: 20px 0">üéÆ</div>
                  <h2 style="color: #667eea">
                    Echo<span style="color: #764ba2">MMO</span>
                  </h2>
                </div>
                <div class="mockup-element">
                  <strong>üìù Username Input</strong>
                  <p>[Text input field: "Username"]</p>
                </div>
                <div class="mockup-element">
                  <strong>üîë Password Input</strong>
                  <p>[Password input field: "Password"]</p>
                </div>
                <div class="mockup-element">
                  <strong>üîò Button</strong>
                  <p>[Sign in] - Gradient Purple button</p>
                </div>
                <div class="mockup-element">
                  <strong>üîó Links</strong>
                  <p>[Qu√™n m·∫≠t kh·∫©u?] | [ƒêƒÉng k√Ω]</p>
                </div>
              </div>
            </div>

            <h3>8.2. Trang Marketplace</h3>
            <div class="mockup-container">
              <div class="mockup-screen">
                <div class="mockup-header">üè™ Marketplace</div>
                <div class="mockup-element">
                  <strong>üîç B·ªô l·ªçc</strong>
                  <p>
                    [Search: "T√¨m ki·∫øm..."] [Category: Dropdown] [Max Price:
                    Input] [Button: L·ªçc]
                  </p>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr 1fr;
                    gap: 10px;
                    margin: 10px 0;
                  "
                >
                  <div
                    style="
                      border: 2px solid #ddd;
                      padding: 10px;
                      border-radius: 8px;
                      text-align: center;
                    "
                  >
                    <div style="font-size: 2em">üó°Ô∏è</div>
                    <strong>Ki·∫øm G·ªó</strong>
                    <p style="color: #999">Common</p>
                    <p>x1</p>
                    <p style="color: #f59e0b; font-weight: bold">üí∞ 10.00</p>
                    <button
                      style="
                        background: #10b981;
                        color: white;
                        border: none;
                        padding: 5px 10px;
                        border-radius: 4px;
                        cursor: pointer;
                      "
                    >
                      Mua ngay
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="section" id="implementation">
            <h2>9. üöÄ Quy tr√¨nh Tri·ªÉn khai</h2>

            <h3>9.1. Lu·ªìng Ph√°t tri·ªÉn: Database ‚Üí Backend ‚Üí Frontend</h3>

            <div class="flow-step">
              <strong>B∆∞·ªõc 1: Thi·∫øt k·∫ø Database</strong>
              <p>‚úÖ T·∫°o ERD, x√°c ƒë·ªãnh c√°c b·∫£ng v√† m·ªëi quan h·ªá</p>
              <p>‚úÖ Vi·∫øt SQL script t·∫°o tables, indexes, constraints</p>
              <p>‚úÖ T·∫°o Stored Procedures cho business logic ph·ª©c t·∫°p</p>
              <p>‚úÖ Insert d·ªØ li·ªáu m·∫´u (roles, items, enemies)</p>
            </div>

            <div class="flow-step">
              <strong>B∆∞·ªõc 2: T·∫°o Entity Models (JPA)</strong>
              <p>‚úÖ T·∫°o class @Entity t∆∞∆°ng ·ª©ng v·ªõi m·ªói b·∫£ng</p>
              <p>‚úÖ ƒê·ªãnh nghƒ©a @Id, @GeneratedValue</p>
              <p>‚úÖ Thi·∫øt l·∫≠p quan h·ªá @OneToOne, @OneToMany, @ManyToOne</p>
              <p>‚úÖ S·ª≠ d·ª•ng Lombok ƒë·ªÉ gi·∫£m boilerplate code</p>
            </div>

            <div class="flow-step">
              <strong>B∆∞·ªõc 3: Implement Service Layer</strong>
              <p>‚úÖ Vi·∫øt business logic trong @Service classes</p>
              <p>‚úÖ S·ª≠ d·ª•ng @Transactional cho c√°c thao t√°c ph·ª©c t·∫°p</p>
              <p>‚úÖ G·ªçi Stored Procedures qua EntityManager khi c·∫ßn</p>
              <p>‚úÖ X·ª≠ l√Ω exceptions v√† validation</p>
            </div>
          </div>

          <div class="section" id="appendix-a">
            <h2>üìé Ph·ª• l·ª•c A: Chi ti·∫øt Stored Procedures</h2>

            <h3>A.1. sp_create_player_listing</h3>
            <div class="info-box">
              <h4>M·ª•c ƒë√≠ch</h4>
              <p>
                T·∫°o ni√™m y·∫øt b√°n h√†ng m·ªõi t·ª´ Player, tr·ª´ v·∫≠t ph·∫©m kh·ªèi inventory
                v√† t·∫°o record trong market_listing
              </p>

              <h4>Parameters</h4>
              <ul>
                <li><code>@seller_id INT</code> - ID c·ªßa ng∆∞·ªùi b√°n</li>
                <li><code>@item_id INT</code> - ID c·ªßa v·∫≠t ph·∫©m</li>
                <li><code>@quantity INT</code> - S·ªë l∆∞·ª£ng b√°n</li>
                <li><code>@price DECIMAL(18,2)</code> - Gi√° b√°n</li>
              </ul>
            </div>
          </div>

          <div class="section" id="appendix-b">
            <h2>üìé Ph·ª• l·ª•c B: Danh s√°ch API Endpoints</h2>

            <h3>B.1. Authentication APIs</h3>
            <table>
              <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Description</th>
              </tr>
              <tr>
                <td><span class="badge badge-get">GET</span></td>
                <td><code>/login</code></td>
                <td>Hi·ªÉn th·ªã trang ƒëƒÉng nh·∫≠p</td>
              </tr>
              <tr>
                <td><span class="badge badge-post">POST</span></td>
                <td><code>/login</code></td>
                <td>X·ª≠ l√Ω ƒëƒÉng nh·∫≠p (Spring Security)</td>
              </tr>
              <tr>
                <td><span class="badge badge-get">GET</span></td>
                <td><code>/register</code></td>
                <td>Hi·ªÉn th·ªã trang ƒëƒÉng k√Ω</td>
              </tr>
              <tr>
                <td><span class="badge badge-post">POST</span></td>
                <td><code>/register</code></td>
                <td>X·ª≠ l√Ω ƒëƒÉng k√Ω t√†i kho·∫£n m·ªõi</td>
              </tr>
            </table>
          </div>

          <div class="footer">
            <h2>üéÆ EchoMMO</h2>
            <p style="color: #666; font-size: 1.1em; margin: 10px 0">
              GameFi MMO Platform
            </p>
            <p style="color: #999; margin-top: 20px">
              ¬© 2025 EchoMMO Project | T√†i li·ªáu Ph√¢n t√≠ch & Thi·∫øt k·∫ø H·ªá th·ªëng
            </p>
            <p style="color: #999; font-size: 0.9em">
              Version 1.0.0 | Last Updated: January 2025
            </p>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

      mermaid.initialize({
        startOnLoad: true,
        theme: "base",
        securityLevel: "loose",
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
          curve: "basis",
        },
        themeVariables: {
          primaryColor: "#667eea",
          primaryBorderColor: "#667eea",
          secondaryColor: "#764ba2",
          textColor: "#333",
          lineColor: "#764ba2",
          mainBkg: "#f8f9fa",
          nodeBorder: "#667eea",
          edgeLabelBackground: "#fff",
          edgeLabelColor: "#667eea",
        },
      });

      // Style edge labels sau khi Mermaid render xong
      setTimeout(() => {
        const edgeLabels = document.querySelectorAll(".edgeLabel");
        edgeLabels.forEach((label) => {
          label.style.background = "linear-gradient(135deg, #667eea, #764ba2)";
          label.style.color = "white";
          label.style.padding = "4px 12px";
          label.style.borderRadius = "12px";
          label.style.fontSize = "12px";
          label.style.fontWeight = "600";
          label.style.boxShadow = "0 2px 4px rgba(0,0,0,0.2)";
        });
      }, 1000);

      // Scroll to top button
      window.addEventListener("scroll", function () {
        const scrollTop = document.getElementById("scrollTop");
        if (window.pageYOffset > 300) {
          scrollTop.classList.add("show");
        } else {
          scrollTop.classList.remove("show");
        }
      });
    </script>
  </body>
</html>
